\subsubsection{Wiberg}
\label{sec:wiberg}

Wiberg algorithms for fitting AAMs are based on applying the Wiberg algorithm \cite{Okatani2006} to solve the nonlinear minimization problem defined by Eq. \ref{eq:ssd}. As previously seen, the residual $\mathbf{r}(\mathbf{c}, \mathbf{p})$ is linear with respect to the appearance parameters $\mathbf{c}$ but non-linear with respect to shape parameters $\mathbf{p}$. Moreover, we have also seen how given a fixed value for the increments on shape parameters $\delta\mathbf{p}_k$ the solution with respect to the increments on the appearance parameters was given by Eq. \ref{eq:} and that given a fixed value a fixed value for increments on appearance parameters $\delta\mathbf{p}_k$ the solution with respect to increments on the shape parameters was given by Eq. \ref{eq:}. The idea behind the Wiberg algorithm is similar to the one of alternating optimization. However, Wiberg e...

\begin{equation}
    \begin{aligned}
        \hat{\mathbf{c}}(\mathbf{p}) & = (\mathbf{A}^T\mathbf{A})^{-1} \mathbf{A}^T \left( \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} \right) 
        \\
        & = \mathbf{A}^T \left( \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} \right) 
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

\begin{equation}
    \begin{aligned}
        \mathbf{r}(\mathbf{p}, \hat{\mathbf{c}}(\mathbf{p})) & = \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} - \mathbf{A} \hat{\mathbf{c}}(\mathbf{p})
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

\begin{equation}
    \begin{aligned}
        \mathbf{e}(\mathbf{p}) & = \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} - \mathbf{A} \left( \mathbf{A}^T \left( \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} \right) \right)
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

Then, we can rewrite the optimization problem posed by Eq. \ref{eq:ssd} as:

\begin{equation}
    \begin{aligned}
        \mathbf{p}_o & = \underset{\mathbf{p}}{\mathrm{arg\,min\;}} \mathbf{r}(\mathbf{p}, \hat{\mathbf{c}}(\mathbf{p}))^T\mathbf{r}(\mathbf{p}, \hat{\mathbf{c}}(\mathbf{p}))
        \\
        & = \underset{\mathbf{p}}{\mathrm{arg\,min\;}} \mathbf{e}(\mathbf{p})^T\mathbf{e}(\mathbf{p})
        \\
        & = \underset{\mathbf{p}}{\mathrm{arg\,min\;}}  \left\| \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} - \mathbf{A} \left( \mathbf{A}^T \left( \mathbf{i}[\mathbf{p}] - \bar{\mathbf{a}} \right) \right) \right\|^2
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

\begin{equation}
    \begin{aligned}
        \delta\mathbf{p}_o & = \underset{\delta\mathbf{p}}{\mathrm{arg\,min\;}}  \left\| \mathbf{e}(\mathbf{p}) + \frac{\partial\mathbf{e}}{\partial\mathbf{p}} \delta\mathbf{p} \right\|^2
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

\begin{equation}
    \begin{aligned}
        \frac{\partial\mathbf{e}}{\partial\mathbf{p}} & = \frac{\partial\mathbf{r}}{\partial\mathbf{p}} + \frac{\partial\mathbf{r}}{\partial\mathbf{c}} \frac{\partial\hat{\mathbf{c}}}{\partial\mathbf{p}} 
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}

\begin{equation}
    \begin{aligned}
        \frac{\partial\mathbf{r}}{\partial\mathbf{p}} = \mathbf{J}, \qquad \frac{\partial\mathbf{r}}{\partial\mathbf{c}} = \mathbf{A}  
    \label{eq:ssd_appearance}
    \end{aligned}
\end{equation}
where the Jacobian $\mathbf{J} = \nabla\mathbf{i}[\mathbf{p}] \frac{\partial\mathcal{W}}{\partial\mathbf{p}}$ or $\mathbf{J} = -\nabla \left( \bar{\mathbf{a}} + \mathbf{A}\mathbf{c} \right) \frac{\partial\mathcal{W}}{\partial\mathbf{p}}$


The forward version of the algorithm, i.e. the \emph{Wiberg Forward Compositional} (WFC) algorithm, was originally derived by Tzimiropoulos and Pantic in \cite{Tzimiropoulos2013}. Their original derivation is somehow ad hoc and involves first a linearization of the residual with respect to $\delta \mathbf{p}$ and then the substitution of the optimal appearance parametrs c. On the contrary we show how the same algorithm can be derived by solving EQ. \ref{eq:ssd} using the Wiberg algorithm. Th

